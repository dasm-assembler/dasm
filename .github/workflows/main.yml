name: Build, Test and Package Snapshots

on:
  push:

jobs:
  build_for_windows:
    runs-on: windows-2019
    name: Build for Windows
    steps:
    - uses: actions/checkout@v2
    - name: Make64
      run: make
      env:
        CC: gcc
    - run: |
        mkdir -p artifacts/windows/64bit
        cp bin/dasm.exe artifacts/windows/64bit/dasm.exe
    - name: Make32
      run: make
      env:
        CC: gcc
        LDFLAGS: -m32
    - run: |
        mkdir -p artifacts/windows/32bit
        cp bin/dasm.exe artifacts/windows/32bit/dasm.exe
    - uses: actions/upload-artifact@v2
      with :
        name: dasm snapshot builds
        path: artifacts

  build_for_mac:
    runs-on: macos-10.15
    name: Build for Mac
    steps:
    - uses: actions/checkout@v2
    - name: Make
      run: make
      env:
        CC: gcc
    - run: |
        mkdir -p artifacts/macos
        cp bin/dasm artifacts/macos/dasm
    - uses: actions/upload-artifact@v2
      with :
        name: dasm snapshot builds
        path: artifacts

  build_for_linux:
    runs-on: ubuntu-18.04
    name: Build for Linux
    steps:
    - uses: actions/checkout@v2
    - name: Make
      run: make
      env:
        CC: gcc
    - run: |
        mkdir -p artifacts/linux
        cp bin/dasm artifacts/linux/dasm
    - uses: actions/upload-artifact@v2
      with :
        name: dasm snapshot builds
        path: artifacts

